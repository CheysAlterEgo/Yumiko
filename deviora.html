<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Deviora's Garden</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      height: 100vh;
      display: flex;
      font-family: "Trebuchet MS", Arial, sans-serif;
      background: #f5ebff;
      overflow: hidden;
    }

    #menu {
      width: 200px;
      height: 100%;
      background: #ead3ff;
      border-right: 3px solid #b37dff;
      position: relative;
      transition: transform 0.35s ease;
      z-index: 10;
      display: flex;
      flex-direction: column;
    }

    #menu.collapsed {
      transform: translateX(-160px);
    }

    #menuHeader {
      position: absolute;
      top: 50%;
      right: -40px;
      width: 40px;
      height: 120px;
      margin-top: -60px;
      background: #b37dff;
      color: #fff;
      font-weight: 700;
      letter-spacing: 2px;
      writing-mode: vertical-rl;
      transform: rotate(180deg);
      text-align: center;
      line-height: 38px;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.15);
      z-index: 20;
    }

    #menuContent {
      padding: 25px 15px 15px;
      overflow-y: auto;
      flex-grow: 1;
    }

    /* Toggle buttons for categories */
    .category-toggle {
      user-select: none;
      background: #b37dff;
      color: white;
      font-weight: 700;
      padding: 10px 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: background 0.3s;
    }
    .category-toggle:hover {
      background: #9a5fe0;
    }
    .category-toggle.active {
      background: #7a44cc;
    }

    /* Flower lists inside categories */
    .flower-list {
      max-height: 250px; /* max height so it can scroll */
      overflow-y: auto;
      margin-bottom: 20px;
      display: none;
      flex-wrap: wrap;
      gap: 10px;
    }
    .flower-list.active {
      display: flex;
    }

    /* Single flower items */
    .flower-option {
      cursor: grab;
      padding: 5px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      user-select: none;
      width: 80px;
      height: 80px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      font-size: 12px;
      text-align: center;
    }
    .flower-option img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      pointer-events: none;
      border-radius: 6px;
      background: #fff;
      margin-bottom: 4px;
    }
    .flower-option:active {
      transform: scale(0.95);
    }

    #garden {
      flex-grow: 1;
      margin: 25px;
      border-radius: 14px;
      border: 3px solid #b37dff;
      overflow: hidden;
      position: relative;
      background-size: cover;
      background-position: center;
      background-color: #c4f0c5;
    }

    .garden-flower {
      position: absolute;
      width: 60px;
      height: 60px;
      cursor: move;
      user-select: none;
      transition: transform 0.2s;
    }

    .garden-flower:active {
      transform: scale(0.9);
    }

    .grow {
      animation: growUp 0.4s ease-out;
    }

    @keyframes growUp {
      0% { transform: scaleY(0); opacity: 0; }
      100% { transform: scaleY(1); opacity: 1; }
    }

    #prevArrow,
    #nextArrow {
      position: absolute;
      top: 20px;
      padding: 8px 14px;
      border: none;
      border-radius: 8px;
      background: #b37dff;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      z-index: 11;
    }

    #prevArrow { left: 240px; }
    #nextArrow { right: 40px; }

    #prevArrow:hover,
    #nextArrow:hover {
      filter: brightness(1.1);
    }
  </style>
</head>

<body>
  <button id="prevArrow">←</button>
  <button id="nextArrow">→</button>

  <div id="menu" class="collapsed">
    <div id="menuHeader">Items</div>
    <div id="menuContent">
      <!-- Category toggles -->
      <div id="singleToggle" class="category-toggle">Single Flowers</div>
      <div id="clusterToggle" class="category-toggle">Cluster Flowers</div>

      <!-- Single flowers list -->
      <div id="singleFlowersList" class="flower-list">
        <div class="flower-option" draggable="true" data-flower="rose" title="Rose">
          <img src="rose.png" alt="Rose" />
        </div>
        <div class="flower-option" draggable="true" data-flower="tulip" title="Tulip">
          <img src="tulip.png" alt="Tulip" />
        </div>
        <div class="flower-option" draggable="true" data-flower="daisy" title="Daisy">
          <img src="daisy.png" alt="Daisy" />
        </div>
        <div class="flower-option" draggable="true" data-flower="lily" title="Lily of the Valley">
          <img src="lilyofthevalley.png" alt="Lily of the Valley" />
        </div>
        <div class="flower-option" draggable="true" data-flower="lavender" title="Lavender">
          <img src="lavender.png" alt="Lavender" />
        </div>
        <div class="flower-option" draggable="true" data-flower="dandelion" title="Dandelion">
          <img src="dandelion.png" alt="Dandelion" />
        </div>
        <div class="flower-option" draggable="true" data-flower="waterlily" title="Water Lily">
          <img src="waterlily.png" alt="Water Lily" />
        </div>
        <div class="flower-option" draggable="true" data-flower="sunflower" title="sunflower">
          <img src="sunflower.png" alt="sunflower" />
        </div>
         <div class="flower-option" draggable="true" data-flower="flower1" title="flower">
          <img src="flower1.png" alt="flower" />
        </div>
        <div class="flower-option" draggable="true" data-flower="flower2" title="flower">
          <img src="flower2.png" alt="flower" />
        </div>
        <div class="flower-option" draggable="true" data-flower="flower3" title="flower">
          <img src="flower3.png" alt="flower" />
        </div>
        <div class="flower-option" draggable="true" data-flower="flower4" title="flower">
          <img src="flower4.png" alt="flower" />
        </div>
         <div class="flower-option" draggable="true" data-flower="flower5" title="flower">
          <img src="flower5.png" alt="flower" />
        </div>
         <div class="flower-option" draggable="true" data-flower="flower6" title="flower">
          <img src="flower6.png" alt="flower" />
        </div>
         <div class="flower-option" draggable="true" data-flower="flower7" title="flower">
          <img src="flower7.png" alt="flower" />
        </div>
      </div>

      <!-- Cluster flowers list -->
      <div id="clusterFlowersList" class="flower-list">
        <div class="flower-option" draggable="true" data-flower="cluster1" title="Cluster 1">
          <img src="cluster1.png" alt="Cluster 1" />
        </div>
        <div class="flower-option" draggable="true" data-flower="cluster2" title="Cluster 2">
          <img src="cluster2.png" alt="Cluster 2" />
        </div>
        <div class="flower-option" draggable="true" data-flower="cluster3" title="Cluster 3">
          <img src="cluster3.png" alt="Cluster 3" />
        </div>
        <div class="flower-option" draggable="true" data-flower="cluster4" title="Cluster 4">
          <img src="cluster4.png" alt="Cluster 4" />
        </div>
        <div class="flower-option" draggable="true" data-flower="cluster5" title="Cluster 5">
          <img src="cluster5.png" alt="Cluster 5" />
        </div>
        <div class="flower-option" draggable="true" data-flower="cluster6" title="Cluster 6">
          <img src="cluster6.png" alt="Cluster 6" />
        </div>
      </div>
    </div>
  </div>

  <!-- Garden must be outside the menu -->
  <div id="garden"></div>

  <script>
    const flowerImages = {
      rose: 'rose.png',
      tulip: 'tulip.png',
      daisy: 'daisy.png',
      lily: 'lilyofthevalley.png',
      lavender: 'lavender.png',
      dandelion: 'dandelion.png',
      waterlily: 'waterlily.png',
      sunflower:'sunflower.png',
      flower1:'flower1.png',
      flower2:'flower2.png',
      flower3:'flower3.png',
      flower4:'flower4.png',
      flower5:'flower5.png',
      flower6:'flower6.png',
      flower7:'flower7.png',
      cluster1: 'cluster1.png',
      cluster2: 'cluster2.png',
      cluster3: 'cluster3.png',
      cluster4: 'cluster4.png',
      cluster5: 'cluster5.png',
      cluster6: 'cluster6.png'
    };

    const backgrounds = [
      'background2.jpg',
      'background4.jpg',
      'background3.jpg',
      'background7.jpg',
      'background6.jpg',
      'background5.jpg'
    ];

    let draggedFlowerType = null;
    let offsetX, offsetY, bgIdx = 0;
    const garden = document.getElementById('garden');
    const menu = document.getElementById('menu');
    const menuHeader = document.getElementById('menuHeader');
    const nextArrow = document.getElementById('nextArrow');
    const prevArrow = document.getElementById('prevArrow');
    const flowerState = {};

    // Toggles and lists
    const singleToggle = document.getElementById('singleToggle');
    const clusterToggle = document.getElementById('clusterToggle');
    const singleFlowersList = document.getElementById('singleFlowersList');
    const clusterFlowersList = document.getElementById('clusterFlowersList');

    // Initialize: all collapsed (lists hidden)
    singleFlowersList.classList.remove('active');
    clusterFlowersList.classList.remove('active');

    function collapseAll() {
      singleFlowersList.classList.remove('active');
      clusterFlowersList.classList.remove('active');
      singleToggle.classList.remove('active');
      clusterToggle.classList.remove('active');
    }

    // Toggle handlers
    singleToggle.addEventListener('click', () => {
      const isActive = singleFlowersList.classList.contains('active');
      collapseAll();
      if (!isActive) {
        singleFlowersList.classList.add('active');
        singleToggle.classList.add('active');
      }
    });

    clusterToggle.addEventListener('click', () => {
      const isActive = clusterFlowersList.classList.contains('active');
      collapseAll();
      if (!isActive) {
        clusterFlowersList.classList.add('active');
        clusterToggle.classList.add('active');
      }
    });

    function setBackground(index) {
      flowerState[bgIdx] = Array.from(garden.children).map(child => ({
        type: child.dataset.type,
        x: parseInt(child.style.left),
        y: parseInt(child.style.top),
        rotation: parseInt(child.dataset.rotation || '0'),
        size: parseFloat(child.dataset.size || 1)
      }));

      garden.innerHTML = '';
      bgIdx = index;
      garden.style.backgroundImage = `url('${backgrounds[bgIdx]}')`;

      const flowers = flowerState[bgIdx] || [];
      flowers.forEach(({ type, x, y, rotation, size }) => {
        createFlower(x, y, type, rotation, false, size);
      });
    }

    function createFlower(x, y, type, rotation = 0, animate = true, scale = 1) {
      if (!(type in flowerImages)) {
        console.warn(`Unknown flower type: ${type}`);
        return;
      }
      const img = document.createElement('img');
      img.src = flowerImages[type];
      img.className = 'garden-flower';
      img.style.left = x + 'px';
      img.style.top = y + 'px';
      img.style.transform = `rotate(${rotation}deg) scale(${scale})`;
      img.dataset.type = type;
      img.dataset.rotation = rotation;
      img.dataset.size = scale;
      img.ondblclick = () => img.remove();

      if (animate) img.classList.add('grow');

      enableFlowerDrag(img);
      enableFlowerRotateAndResize(img);
      garden.appendChild(img);
    }

    function enableFlowerDrag(flower) {
      let dragging = false;
      flower.addEventListener('mousedown', e => {
        dragging = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
      });
      document.addEventListener('mousemove', e => {
        if (!dragging) return;
        const rect = garden.getBoundingClientRect();
        let newX = e.clientX - rect.left - offsetX;
        let newY = e.clientY - rect.top - offsetY;
        newX = Math.max(0, Math.min(newX, garden.clientWidth - flower.clientWidth));
        newY = Math.max(0, Math.min(newY, garden.clientHeight - flower.clientHeight));
        flower.style.left = newX + 'px';
        flower.style.top = newY + 'px';
      });
      document.addEventListener('mouseup', () => dragging = false);
    }

    function enableFlowerRotateAndResize(flower) {
      flower.addEventListener('wheel', (e) => {
        e.preventDefault();
        let rotation = parseInt(flower.dataset.rotation || '0');
        let scale = parseFloat(flower.dataset.size || 1);
        let deltaY = e.deltaY;
        if (e.deltaMode === 1) deltaY *= 15;
        else if (e.deltaMode === 2) deltaY *= 100;
        const scrollDirection = Math.sign(deltaY);

        if (e.shiftKey) {
          scale = Math.min(5, scale + 0.1);
        } else {
          rotation += scrollDirection > 0 ? 15 : -15;
          rotation = (rotation + 360) % 360;
        }

        flower.dataset.rotation = rotation;
        flower.dataset.size = scale.toFixed(2);
        flower.style.transform = `rotate(${rotation}deg) scale(${scale})`;
      }, { passive: false });
    }

    // Drag start handlers for flower options
    document.querySelectorAll('.flower-option').forEach(opt => {
      opt.addEventListener('dragstart', e => {
        draggedFlowerType = e.currentTarget.dataset.flower;
      });
    });

    garden.addEventListener('dragover', e => e.preventDefault());
    garden.addEventListener('drop', e => {
      e.preventDefault();
      if (!draggedFlowerType) return;
      createFlower(e.offsetX - 30, e.offsetY - 30, draggedFlowerType);
      draggedFlowerType = null;
    });

    menuHeader.addEventListener('click', () => menu.classList.toggle('collapsed'));
    nextArrow.addEventListener('click', () => setBackground((bgIdx + 1) % backgrounds.length));
    prevArrow.addEventListener('click', () => setBackground((bgIdx - 1 + backgrounds.length) % backgrounds.length));

    setBackground(0);
  </script>
</body>
</html>
